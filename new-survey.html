<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../card-display/card-display.html">
<link rel="import" href="../paper-material/paper-material.html">
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../paper-input/paper-textarea.html">
<!--
`<new-survey></new-survey>` New Survey
-->
<dom-module id="new-survey">
  <template>
    <style is="custom-style" include="iron-flex iron-flex-alignment">
 
      #surveycards {
        /*padding: 20px;*/
      }
      #surveyq {
        width: 200px;
        /* height: 263px; */
        padding-top: 20px;
        padding-right: 20px;
      }
      h1 {
        font-size: 30px;
      }
      .buttons {
       
      }
      paper-button {
        background: var(--accent-color);
        color: var(--button-background-color);
      }
      paper-material {
        background: #fff;
        padding: 20px;
      }

    </style>
    <div id="surveycards" div class="layout horizontal layout-start">
<!-- Questions -->
      <div id="surveyq">
        <paper-material elevation="1">
          <paper-textarea label="Question" value="{{Question}}" char-counter maxlength="45" required auto-validate error-message="Needs a Question!"></paper-textarea>
          <center>
            <paper-input label="Option 1" value="{{One}}" char-counter maxlength="10"></paper-input>           
            <paper-input label="Option 2" value="{{Two}}" char-counter maxlength="10"></paper-input>
          </center>
        </paper-material>
        </div>
<!-- Preview of what you are tryping -->
        <div id="surveya">
          <card-display style="display:block" cards='{{display}}' viewable></card-display>
        </div>
      </div>
<!-- Buttons -->
      <div class="buttons">
        <paper-button on-tap="add" raised>OK</paper-button>
        <paper-button on-tap="dontdoit" raised>Cancel</paper-button>
      </div>
    </div>
  </template>
</dom-module>

<script>
  Polymer({
    is: 'new-survey',
    properties: {
      display: {
        computed: "getDisplay(Question, One, Two)"
      },
      One: {type: String, value: "Yes"},
      Two: {type: String, value: "No"}
    },
    getDisplay: function(Question, One, Two) {
      return [{
        data: "<center><h3 style='word-wrap: break-word; padding: 30px 10px 0 10px; height: 60px;'>" + Question + "</h3><paper-button raised style='margin: 5px; width: 60%;'>" + One + "</paper-button><paper-button raised style='margin: 5px; width: 60%;'>" + Two + "</paper-button></center>",
        url: "custom"
      }]
    },
    
    add: function() {
      var hash = this.uid + this.Question
      var readableBy = {}
      readableBy[this.uid] = true
        // TODO readableBy other Admins

      this.fire("add-survey", {
        Question: this.Question,
        One: this.One,
        Two: this.Two,
        sharedWidth: 1,
        ones: 0,
        twos: 0,
        data: "<center><h3>{{Question}}</h3><{{tag}} raised>{{One}}</{{tag}}><{{tag}} raised>{{Two}}</{{tag}}><div>{{One}}:{{ones}}<br>{{Two}}:{{twos}}</div></center>",
        tag: "paper-button",
        url: hash,
        readableBy: readableBy
      })

      this.set("Question", "")
      this.set("One", "Yes")
      this.set("Two", "No")
    },
    dontdoit: function() {
      this.fire("close")
    }
  })
</script>
