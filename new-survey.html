<link rel="import" href="/bower_components/paper-button/paper-button.html">
<link rel="import" href="/bower_components/card-display/card-display.html">
<link rel="import" href="/bower_components/paper-material/paper-material.html">
<link rel="import" href="/bower_components/paper-input/paper-input.html">
<link rel="import" href="/bower_components/paper-input/paper-textarea.html">
<link rel="import" href="/bower_components/polymer/polymer.html">

<dom-module id="new-survey">
  <template>
    <div id="surveycards">
      <div id="surveyq">
        <paper-material elevation="1">
          <paper-textarea label="Question" value="{{Question}}" char-counter maxlength="140" required auto-validate error-message="Needs a Question!"></paper-textarea>
          <center>
            <paper-input label="Option 1" value="{{One}}" char-counter maxlength="10"></paper-input>           
            <paper-input label="Option 2" value="{{Two}}" char-counter maxlength="10"></paper-input>
          </center>
        </paper-material>
        </div>
        <div id="surveya">
          <card-display style="display:block" cards='{{display}}' viewable></card-display>
        </div>
      </div>
      <div class="buttons">
        <paper-button on-tap="add" raised>OK</paper-button>
        <paper-button on-tap="dontdoit" raised>Cancel</paper-button>
      </div>
    </div>
  </template>
  <script>
    (function() {
      'use strict';
      Polymer({
        is: 'new-survey',
        properties: {
          display: {
            computed: "getDisplay(Question, One, Two)"
          }
        },
        getDisplay: function(Question, One, Two) {
          return [{
            data: "<center><h1>" + Question + "</h1><paper-button raised>" + One + "</paper-button><paper-button raised>" + Two + "</paper-button></center>",
            url: "custom"
          }]
        },
        add: function() {
          var hash = this.hash(this.uid + this.Question)
          var readableBy = {}
          readableBy[this.uid] = true
          // TODO readableBy other Admins

          this.fire("add", {
            Question: this.Question, Two: this.Two, One: this.One,
            data: "<center><h1>{{Question}}</h1><{{tag}} raised>{{One}}</{{tag}}><{{tag}} raised>{{Two}}</{{tag}}></center>",
            tag: "paper-button", url: hash, readableBy: readableBy
          })

          this.set("Question", "")
          this.set("One", "Yes")
          this.set("Two", "No")
        },
        dontdoit: function() {
          this.fire("close")
        }
     })
   })()
 </script>
</dom-module>
